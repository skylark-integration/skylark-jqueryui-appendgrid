/**
 * skylark-jqueryui-appendgrid - A version of jquery.appendgrid that ported to running on skylarkjs ui.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jqueryui-appendgrid/
 * @license MIT
 */
!function(e,t){var n=t.define,require=t.require,o="function"==typeof n&&n.amd,r=!o&&"undefined"!=typeof exports;if(!o&&!n){var l={};n=t.define=function(e,t,n){"function"==typeof n?(l[e]={factory:n,deps:t.map(function(t){return function(e,t){if("."!==e[0])return e;var n=t.split("/"),o=e.split("/");n.pop();for(var r=0;r<o.length;r++)"."!=o[r]&&(".."==o[r]?n.pop():n.push(o[r]));return n.join("/")}(t,e)}),resolved:!1,exports:null},require(e)):l[e]={factory:null,resolved:!0,exports:n}},require=t.require=function(e){if(!l.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var module=l[e];if(!module.resolved){var n=[];module.deps.forEach(function(e){n.push(require(e))}),module.exports=module.factory.apply(t,n)||null,module.resolved=!0}return module.exports}}if(!n)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,require){e("skylark-jqueryui-appendgrid/appendGrid",["skylark-langx/langx","skylark-domx-query","skylark-jqueryui-interact/Sortable","skylark-jqueryui-interact/Resizable","skylark-jqueryui/widgets/button","skylark-jqueryui/widgets/tooltip"],function(e,t){var n={caption:null,captionTooltip:null,initRows:3,maxRowsAllowed:0,initData:null,columns:null,i18n:null,idPrefix:null,rowDragging:!1,hideButtons:null,hideRowNumColumn:!1,rowButtonsInFront:!1,rowCountName:"_RowCount",buttonClasses:null,sectionClasses:null,customGridButtons:null,customRowButtons:null,customFooterButtons:null,useSubPanel:!1,maintainScroll:!1,maxBodyHeight:0,autoColumnWidth:!0},o={nameFormatter:null,dataLoaded:null,rowDataLoaded:null,afterRowAppended:null,afterRowInserted:null,afterRowSwapped:null,beforeRowRemove:null,afterRowRemoved:null,afterRowDragged:null,subPanelBuilder:null,subPanelGetter:null,maxNumRowsReached:null},r={type:"text",name:null,value:null,display:null,displayCss:null,displayTooltip:null,headerSpan:1,cellCss:null,ctrlAttr:null,ctrlProp:null,ctrlCss:null,ctrlClass:null,ctrlOptions:null,uiOption:null,uiTooltip:null,resizable:!1,invisible:!1,emptyCriteria:null,customBuilder:null,customGetter:null,customSetter:null,onClick:null,onChange:null},l={noColumnInfo:"Cannot initial grid without column information!",elemNotTable:"Cannot initial grid on element other than TABLE!",notInit:"`appendGrid` does not initialized",getValueMultiGrid:"Cannot get values on multiple grid",notSupportMethod:"Method is not supported by `appendGrid`: "},i={append:"Append Row",removeLast:"Remove Last Row",insert:"Insert Row Above",remove:"Remove Current Row",moveUp:"Move Up",moveDown:"Move Down",rowDrag:"Sort Row",rowEmpty:"This Grid Is Empty"},a={append:null,removeLast:null,insert:null,remove:null,moveUp:null,moveDown:null,rowDrag:null},s={caption:null,header:null,body:null,subPanel:null,footer:null},u={append:!1,removeLast:!1,insert:!1,remove:!1,moveUp:!1,moveDown:!1},d={init:function(d){if(this.length>0){if(!e.isArray(d.columns)||0==d.columns.length)return alert(l.noColumnInfo),this;var c,h,w,b,x,O,R,B=this[0];if(C(B.tagName)||"TABLE"!=B.tagName)return alert(l.elemNotTable),this;var k,S,I=e.extend({},n,o,d);e.extend(I,{_uniqueIndex:0,_rowOrder:[],_isDataLoaded:!1,_visibleCount:0,_finalColSpan:0,_hideLastColumn:!1,_wrapperId:null,_calculateWidth:!0}),e.isPlainObject(d.i18n)?I._i18n=e.extend({},i,d.i18n):I._i18n=e.extend({},i),e.isPlainObject(d.buttonClasses)?I._buttonClasses=e.extend({},a,d.buttonClasses):I._buttonClasses=e.extend({},a),e.isPlainObject(d.sectionClasses)?I._sectionClasses=e.extend({},s,d.sectionClasses):I._sectionClasses=e.extend({},s),e.isPlainObject(d.hideButtons)?I.hideButtons=e.extend({},u,d.hideButtons):I.hideButtons=e.extend({},u),C(I.idPrefix)&&(C(B.id)||""==B.id?I.idPrefix="ag"+(new Date).getTime():I.idPrefix=B.id),e.isPlainObject(I.customGridButtons)||(I.customGridButtons={}),I.useSubPanel&&I.rowDragging&&(I.rowDragging=!1),(h=document.createElement("thead")).className="ui-widget-header",(w=document.createElement("tbody")).className="ui-widget-content",(b=document.createElement("tfoot")).className="ui-widget-header",x=document.createElement("colgroup"),I._wrapperId=I.idPrefix+"-wrapper",c=document.createElement("div"),t(c).attr("id",I._wrapperId).addClass("appendGrid").insertAfter(B),t(B).empty().addClass("ui-widget").appendTo(c),I.maxBodyHeight>0?(t("<table></table>").addClass("ui-widget head").append(h).prependTo(c),t(B).addClass("body").wrap(t("<div></div>").addClass("scroller").css("max-height",I.maxBodyHeight)).append(x,w),t("<table></table>").addClass("ui-widget foot").append(b).appendTo(c)):t(B).addClass("head body foot").append(x,h,w,b),h.appendChild(O=document.createElement("tr")),I._sectionClasses.header?O.className="columnHead "+I._sectionClasses.header:O.className="columnHead",I.hideRowNumColumn||(O.appendChild(k=document.createElement("td")),k.className="ui-widget-header first",x.appendChild(document.createElement("col")));for(var E=0,D=0;D<I.columns.length;D++){var G=e.extend({},r,I.columns[D]);if(I.columns[D]=G,"hidden"!=I.columns[D].type)if(I.columns[D].invisible||I._visibleCount++,0==E){var T="ui-widget-header";I.columns[D].invisible&&(T+=" invisible"),I.columns[D].resizable&&(T+=" resizable"),O.appendChild(R=document.createElement("td")),R.id=I.idPrefix+"_"+I.columns[D].name+"_td_head",R.className=T,I.columns[D].displayCss&&t(R).css(I.columns[D].displayCss),I.columns[D].headerSpan>1&&(t(R).attr("colSpan",I.columns[D].headerSpan),E=I.columns[D].headerSpan-1),e.isPlainObject(I.columns[D].displayTooltip)?t(R).tooltip(I.columns[D].displayTooltip):C(I.columns[D].displayTooltip)||t(R).attr("title",I.columns[D].displayTooltip).tooltip(),e.isFunction(I.columns[D].display)?I.columns[D].display(R):C(I.columns[D].display)||t(R).text(I.columns[D].display),x.appendChild(document.createElement("col"))}else E--}if(C(jQuery.ui.resizable)||t("td.resizable",h).resizable({handles:"e"}),I.hideButtons.insert&&I.hideButtons.remove&&I.hideButtons.moveUp&&I.hideButtons.moveDown&&(!e.isArray(I.customRowButtons)||0==I.customRowButtons.length)&&(I._hideLastColumn=!0),I._finalColSpan=I._visibleCount,I.hideRowNumColumn||I._finalColSpan++,I._hideLastColumn||I._finalColSpan++,I._hideLastColumn||(I.rowButtonsInFront?I.hideRowNumColumn?O.insertBefore(S=document.createElement("td"),O.firstChild):O.insertBefore(S=document.createElement("td"),O.childnodes[1]):O.appendChild(S=document.createElement("td")),S.className="ui-widget-header last",S.id=I.idPrefix+"_last_td_head",x.appendChild(document.createElement("col"))),I.caption&&(h.insertBefore(O=document.createElement("tr"),h.firstChild),I._sectionClasses.caption&&(O.className=I._sectionClasses.caption),O.appendChild(R=document.createElement("td")),R.id=I.idPrefix+"_caption_td",R.className="ui-state-active caption",R.colSpan=I._finalColSpan,e.isPlainObject(I.captionTooltip)?t(R).tooltip(I.captionTooltip):C(I.captionTooltip)||t(R).attr("title",I.captionTooltip).tooltip(),e.isFunction(I.caption)?I.caption(R):t(R).text(I.caption)),b.appendChild(O=document.createElement("tr")),I._sectionClasses.footer&&(O.className=I._sectionClasses.footer),O.appendChild(R=document.createElement("td")),R.id=I.idPrefix+"_footer_td",R.colSpan=I._finalColSpan,t("<input/>").attr({type:"hidden",id:I.idPrefix+"_rowOrder",name:I.idPrefix+"_rowOrder"}).appendTo(R),!I.hideButtons.append||!I.hideButtons.removeLast||e.isArray(I.customFooterButtons)&&0!=I.customFooterButtons.length){if(!I.hideButtons.append){var F=P(I.customGridButtons.append,"ui-icon-plusthick").attr({title:I._i18n.append}).addClass("append").click(function(e){return m(B,1,null,null),e&&e.preventDefault&&e.preventDefault(),!1}).appendTo(R);C(I._buttonClasses.append)||F.addClass(I._buttonClasses.append)}if(!I.hideButtons.removeLast){var F=P(I.customGridButtons.removeLast,"ui-icon-closethick").attr({title:I._i18n.removeLast}).addClass("removeLast").click(function(e){return f(B,null,this.value,!1),e&&e.preventDefault&&e.preventDefault(),!1}).appendTo(R);C(I._buttonClasses.removeLast)||F.addClass(I._buttonClasses.removeLast)}if(I.customFooterButtons&&I.customFooterButtons.length){for(var q=I.customFooterButtons.length-1;q>=0;q--){var L=I.customFooterButtons[q];L&&L.uiButton&&L.click&&L.atTheFront&&t(R).prepend(p(B,L))}for(var q=0;q<I.customFooterButtons.length;q++){var L=I.customFooterButtons[q];L&&L.uiButton&&L.click&&!L.atTheFront&&t(R).append(p(B,L))}}}else O.style.display="none";I.rowDragging&&t(w).sortable({axis:"y",containment:B,handle:".rowDrag",helper:function(e,n){var o=n.children(),r=n.clone();return r.children().each(function(e){t(this).width(o.eq(e).width());var n=t("select",this);if(n.length>0)for(var r=0;r<n.length;r++){var l=o.eq(e).find("select");l.length>r&&(n[r].value=l[r].value)}}),r},update:function(n,o){var r=o.item[0].id.substring(o.item[0].id.lastIndexOf("_")+1),l=o.item[0].rowIndex-t("tr",h).length;!function(n,o,r,l){for(var i=t(n).data("appendGrid"),a=-1,s=0;s<i._rowOrder.length;s++)if(i._rowOrder[s]==r){o?(a=l,i._rowOrder.splice(s,1),i._rowOrder.splice(l,0,r)):(a=s,i._rowOrder.splice(l+1,0,r),i._rowOrder.splice(s,1));break}_(n,a),y(n,i),e.isFunction(i.afterRowDragged)&&i.afterRowDragged(n,l,r)}(B,o.originalPosition.top>o.position.top,r,l)}}),t(B).data("appendGrid",I),e.isArray(d.initData)?g(B,d.initData,!0):t(B).appendGrid("appendRow",I.initRows),0==I._rowOrder.length&&v(c,I,!0),I.maxBodyHeight>0&&(I.autoColumnWidth?N(c):t("table.foot",c).width(t(B).width()))}return this},isReady:function(){var e=c(this,!0);return!!e},isDataLoaded:function(){var e=c(this);return!!e&&e._isDataLoaded},load:function(e){var t=c(this);return t&&(null!=e&&e.length>0?g(this[0],e,!1):w(this[0])),this},appendRow:function(e){return this.appendGrid("insertRow",e)},insertRow:function(n,o,r){var l=c(this);if(l&&(e.isArray(n)&&n.length>0||e.isNumeric(n)&&n>0)){var i=this[0];if(insertResult=m(i,n,o,r),e.isNumeric(o)||e.isNumeric(r)){_(i,insertResult.rowIndex);var a=l._rowOrder[insertResult.addedRows[0]];t("#"+l.idPrefix+"_Insert_"+a,i).focus()}}return this},removeRow:function(e,t){var n=c(this);return n&&n._rowOrder.length>0&&f(this[0],e,t,!0),this},emptyGrid:function(){var e=c(this);return e&&w(this[0]),target},moveUpRow:function(n,o){var r=c(this);if(r){var l,i,a,s,u=this[0],d=null,m=u.getElementsByTagName("tbody")[0];e.isNumeric(n)&&n>0&&n<r._rowOrder.length?(d=n,o=r._rowOrder[n]):e.isNumeric(o)&&(d=b(o,r)),null!=d&&d>0&&(l=document.getElementById(r.idPrefix+"_Row_"+o,u),i=document.getElementById(r.idPrefix+"_Row_"+r._rowOrder[d-1],u),r.useSubPanel&&(a=document.getElementById(r.idPrefix+"_SubRow_"+o,u)),m.removeChild(l),r.useSubPanel&&m.removeChild(a),m.insertBefore(l,i),r.useSubPanel&&m.insertBefore(a,i),r._rowOrder[d]=r._rowOrder[d-1],r._rowOrder[d-1]=o,s=t("td.first",i).html(),t("td.first",i).html(t("td.first",l).html()),t("td.first",l).html(s),y(u,r),t("td.last button.moveUp",l).removeClass("ui-state-hover").blur(),t("td.last button.moveUp",i).focus(),r.afterRowSwapped&&r.afterRowSwapped(u,d,d-1))}return this},moveDownRow:function(n,o){var r=c(this);if(r){var l,i,a,s,u=this[0],d=null,m=u.getElementsByTagName("tbody")[0];e.isNumeric(n)&&n>=0&&n<r._rowOrder.length-1?(d=n,o=r._rowOrder[n]):e.isNumeric(o)&&(d=b(o,r)),null!=d&&d!=r._rowOrder.length-1&&(l=document.getElementById(r.idPrefix+"_Row_"+o,u),i=document.getElementById(r.idPrefix+"_Row_"+r._rowOrder[d+1],u),r.useSubPanel&&(a=document.getElementById(r.idPrefix+"_SubRow_"+r._rowOrder[d+1],u)),m.removeChild(i),m.insertBefore(i,l),r.useSubPanel&&m.insertBefore(a,l),r._rowOrder[d]=r._rowOrder[d+1],r._rowOrder[d+1]=o,s=t("td.first",i).html(),t("td.first",i).html(t("td.first",l).html()),t("td.first",l).html(s),y(u,r),t("td.last button.moveDown",l).removeClass("ui-state-hover").blur(),t("td.last button.moveDown",i).focus(),r.afterRowSwapped&&r.afterRowSwapped(u,d,d+1))}return this},showColumn:function(e){var n=c(this);if(n&&e){for(var o=-1,r=this[0],l=0;l<n.columns.length;l++)if(n.columns[l].name==e){o=l;break}if(-1!=o&&n.columns[o].invisible){n._visibleCount++,n._finalColSpan++,t("#"+n.idPrefix+"_caption_td").attr("colSpan",n._finalColSpan),t("#"+n.idPrefix+"_footer_td").attr("colSpan",n._finalColSpan),t("#"+n.idPrefix+"_"+e+"_td_head").removeClass("invisible");for(var l=0;l<n._rowOrder.length;l++){var i=n._rowOrder[l];t("#"+n.idPrefix+"_"+e+"_td_"+i).removeClass("invisible"),n.useSubPanel&&t("#"+n.idPrefix+"_SubRow_"+i).attr("colSpan",n._visibleCount+(n._hideLastColumn?0:1))}n.columns[o].invisible=!1,y(r,n)}}return this},hideColumn:function(e){var n=c(this);if(n&&e){for(var o=-1,r=this[0],l=0;l<n.columns.length;l++)if(n.columns[l].name==e){o=l;break}if(-1!=o&&!n.columns[o].invisible){n._visibleCount--,n._finalColSpan--,t("#"+n.idPrefix+"_caption_td").attr("colSpan",n._finalColSpan),t("#"+n.idPrefix+"_footer_td").attr("colSpan",n._finalColSpan),t("#"+n.idPrefix+"_"+e+"_td_head").addClass("invisible");for(var l=0;l<n._rowOrder.length;l++){var i=n._rowOrder[l];t("#"+n.idPrefix+"_"+e+"_td_"+i).addClass("invisible"),n.useSubPanel&&t("#"+n.idPrefix+"_SubRow_"+i).attr("colSpan",n._visibleCount+(n._hideLastColumn?0:1))}n.columns[o].invisible=!0,y(r,n)}}return this},isColumnInvisible:function(e){var t=c(this);if(t&&e)for(var n=0;n<t.columns.length;n++)if(t.columns[n].name==e)return t.columns[n].invisible;return null},getRowCount:function(){var e=c(this);return e?e._rowOrder.length:null},getUniqueIndex:function(t){var n=c(this);return n&&e.isNumeric(t)&&t<n._rowOrder.length?n._rowOrder[t]:null},getRowIndex:function(t){var n=c(this);if(n&&e.isNumeric(t))for(var o=0;o<n._rowOrder.length;o++)if(n._rowOrder[o]==t)return o;return null},getRowValue:function(t,n,o){var r=c(this),l=null;return r&&(e.isNumeric(t)&&t>=0&&t<r._rowOrder.length&&(n=r._rowOrder[t]),C(n)||(l=x(r,n,o))),l},getAllValue:function(t){var n=c(this),o=null;if(n){o=t?{}:[];for(var r=0;r<n._rowOrder.length;r++)t?(rowValue=x(n,n._rowOrder[r],r),e.extend(o,rowValue)):(rowValue=x(n,n._rowOrder[r]),o.push(rowValue));t&&(o[n.rowCountName]=n._rowOrder.length)}return o},getCtrlValue:function(e,t){var n=c(this);if(n&&t>=0&&t<n._rowOrder.length)for(var o=0;o<n.columns.length;o++)if(n.columns[o].name===e)return O(n,o,n._rowOrder[t]);return null},setCtrlValue:function(e,t,n){var o=c(this);if(o&&t>=0&&t<o._rowOrder.length)for(var r=0;r<o.columns.length;r++)if(o.columns[r].name==e){B(o,r,o._rowOrder[t],n);break}return this},getCellCtrl:function(e,t){var n=c(this);if(n&&t>=0&&t<n._rowOrder.length)for(var o=n._rowOrder[t],r=0;r<n.columns.length;r++)if(n.columns[r].name===e)return R(n.columns[r].type,n.idPrefix,e,o);return null},getCellCtrlByUniqueIndex:function(e,t){var n=c(this);if(n)for(var o=0;o<n.columns.length;o++)if(n.columns[o].name===e)return R(n.columns[o].type,n.idPrefix,e,t);return null},getRowOrder:function(){var e=c(this);return e?e._rowOrder.slice():null},getColumns:function(){var e=c(this);return e?e.columns.slice():null},isRowEmpty:function(e){var t=c(this);return t?k(t,e):null},removeEmptyRows:function(){var e=c(this);if(e){for(var t=this[0],n=e._rowOrder.length;n>=0;n--)k(e,n)&&f(t,null,e._rowOrder[n],!0);return this}return null}};function c(e,t){var n=null;return 1==e.length?(n=e.data("appendGrid"))||t||alert(l.notInit):t||alert(l.getValueMultiGrid),n}function m(n,o,r,l){var i,a,s,u,d=t(n).data("appendGrid"),c=[],m=null,p=[],v=(n.getElementsByTagName("thead")[0],n.getElementsByTagName("tbody")[0]),w=null,_=!1,g=!1,b=0,x=0;d.maxBodyHeight>0&&t("#"+d._wrapperId+" table thead")[0];var O=o,R=!1;if(e.isArray(o)&&(O=o.length,R=!0),e.isNumeric(l)){for(var k=0;k<d._rowOrder.length;k++)if(d._rowOrder[k]==l){r=k,0!=k&&(m=k-1);break}}else e.isNumeric(r)?r>=d._rowOrder.length?r=null:m=r-1:0!=d._rowOrder.length&&(r=null,m=d._rowOrder.length-1);d.maintainScroll&&!e.isNumeric(r)&&(b=t(n).height(),x=t(n).scrollParent().scrollTop()),0==d._rowOrder.length&&(t("tr.empty",n).remove(),g=!0);for(var k=0;k<O;k++){if(0<d.maxRowsAllowed&&d._rowOrder.length>=d.maxRowsAllowed){_=!0;break}d._uniqueIndex++,i=d._uniqueIndex,p.length=0,e.isNumeric(r)?(d._rowOrder.splice(r,0,i),d.useSubPanel?(v.insertBefore(w=document.createElement("tr"),v.childNodes[2*r]),v.insertBefore(s=document.createElement("tr"),v.childNodes[2*r])):v.insertBefore(s=document.createElement("tr"),v.childNodes[r]),c.push(r)):(d._rowOrder.push(i),v.appendChild(s=document.createElement("tr")),d.useSubPanel&&v.appendChild(w=document.createElement("tr")),c.push(d._rowOrder.length-1)),s.id=d.idPrefix+"_Row_"+i,d._sectionClasses.body&&(s.className=d._sectionClasses.body),t(s).data("appendGrid",i),null!=w&&(w.id=d.idPrefix+"_SubRow_"+i,t(w).data("appendGrid",i),d._sectionClasses.subPanel&&(w.className=d._sectionClasses.subPanel)),d.hideRowNumColumn||(s.appendChild(u=document.createElement("td")),t(u).addClass("ui-widget-content first").text(d._rowOrder.length),d.useSubPanel&&(u.rowSpan=2));for(var S=0;S<d.columns.length;S++)if("hidden"!=d.columns[S].type){var I="ui-widget-content";d.columns[S].invisible&&(I+=" invisible"),s.appendChild(u=document.createElement("td")),u.id=d.idPrefix+"_"+d.columns[S].name+"_td_"+i,u.className=I,null!=d.columns[S].cellCss&&t(u).css(d.columns[S].cellCss);var E,D=d.idPrefix+"_"+d.columns[S].name+"_"+i;if(E=e.isFunction(d.nameFormatter)?d.nameFormatter(d.idPrefix,d.columns[S].name,i):D,a=null,"custom"==d.columns[S].type)e.isFunction(d.columns[S].customBuilder)&&(a=d.columns[S].customBuilder(u,d.idPrefix,d.columns[S].name,i));else if("select"==d.columns[S].type||"ui-selectmenu"==d.columns[S].type){if((a=document.createElement("select")).id=D,a.name=E,e.isArray(d.columns[S].ctrlOptions)){if(d.columns[S].ctrlOptions.length>0)if(e.isPlainObject(d.columns[S].ctrlOptions[0]))for(var G=null,T=null,F=0;F<d.columns[S].ctrlOptions.length;F++){C(d.columns[S].ctrlOptions[F].group)?T=null:G!=d.columns[S].ctrlOptions[F].group&&(G=d.columns[S].ctrlOptions[F].group,(T=document.createElement("optgroup")).label=G,a.appendChild(T));var q=t("<option/>").val(d.columns[S].ctrlOptions[F].value).text(d.columns[S].ctrlOptions[F].label);C(d.columns[S].ctrlOptions[F].title)||q.attr("title",d.columns[S].ctrlOptions[F].title),null==T?q.appendTo(a):q.appendTo(T)}else for(var F=0;F<d.columns[S].ctrlOptions.length;F++)a.options[a.options.length]=new Option(d.columns[S].ctrlOptions[F],d.columns[S].ctrlOptions[F])}else if(e.isPlainObject(d.columns[S].ctrlOptions))for(var F in d.columns[S].ctrlOptions)a.options[a.options.length]=new Option(d.columns[S].ctrlOptions[F],F);else if("string"==typeof d.columns[S].ctrlOptions)for(var L=d.columns[S].ctrlOptions.split(";"),F=0;F<L.length;F++){var A=L[F].indexOf(":");a.options[a.options.length]=-1==A?new Option(L[F],L[F]):new Option(L[F].substring(A+1,L[F].length),L[F].substring(0,A))}else e.isFunction(d.columns[S].ctrlOptions)&&d.columns[S].ctrlOptions(a);u.appendChild(a),"ui-selectmenu"==d.columns[S].type&&t(a).selectmenu(d.columns[S].uiOption)}else if("checkbox"==d.columns[S].type)(a=document.createElement("input")).type="checkbox",a.id=D,a.name=E,a.value=1,u.appendChild(a),u.style.textAlign="center";else if("textarea"==d.columns[S].type)(a=document.createElement("textarea")).id=D,a.name=E,u.appendChild(a);else if(-1!=d.columns[S].type.search(/^(color|date|datetime|datetime\-local|email|month|number|range|search|tel|time|url|week)$/)){a=document.createElement("input");try{a.type=d.columns[S].type}catch(e){}a.id=D,a.name=E,u.appendChild(a)}else(a=document.createElement("input")).type="text",a.id=D,a.name=E,u.appendChild(a),"ui-datepicker"==d.columns[S].type?t(a).datepicker(d.columns[S].uiOption):"ui-spinner"==d.columns[S].type?t(a).spinner(d.columns[S].uiOption):"ui-autocomplete"==d.columns[S].type&&t(a).autocomplete(d.columns[S].uiOption);"custom"!=d.columns[S].type&&(null!=d.columns[S].ctrlAttr&&t(a).attr(d.columns[S].ctrlAttr),null!=d.columns[S].ctrlProp&&t(a).prop(d.columns[S].ctrlProp),null!=d.columns[S].ctrlCss&&t(a).css(d.columns[S].ctrlCss),null!=d.columns[S].ctrlClass&&t(a).addClass(d.columns[S].ctrlClass),d.columns[S].uiTooltip&&t(a).tooltip(d.columns[S].uiTooltip),e.isFunction(d.columns[S].onClick)&&t(a).click({caller:n,callback:d.columns[S].onClick,uniqueIndex:i},function(e){e.data.callback(e,t(e.data.caller).appendGrid("getRowIndex",e.data.uniqueIndex))}),e.isFunction(d.columns[S].onChange)&&t(a).change({caller:n,callback:d.columns[S].onChange,uniqueIndex:i},function(e){e.data.callback(e,t(e.data.caller).appendGrid("getRowIndex",e.data.uniqueIndex))})),R?B(d,S,i,o[k][d.columns[S].name]):C(d.columns[S].value)||B(d,S,i,d.columns[S].value)}else p.push(S);if(!d._hideLastColumn||d.columns.length>d._visibleCount){if(d.rowButtonsInFront?d.hideRowNumColumn?s.insertBefore(u=document.createElement("td"),s.firstChild):s.insertBefore(u=document.createElement("td"),s.childNodes[1]):s.appendChild(u=document.createElement("td")),u.className="ui-widget-content last",u.id=d.idPrefix+"_last_td_"+i,d._hideLastColumn&&(u.style.display="none"),!d.hideButtons.insert){var j=P(d.customGridButtons.insert,"ui-icon-arrowreturnthick-1-w").attr({id:d.idPrefix+"_Insert_"+i,title:d._i18n.insert,tabindex:-1}).addClass("insert").data("appendGrid",{uniqueIndex:i}).click(function(e){var o=t(this).data("appendGrid").uniqueIndex;return t(n).appendGrid("insertRow",1,null,o),e&&e.preventDefault&&e.preventDefault(d._buttonClasses.insert),!1}).appendTo(u);C(d._buttonClasses.insert)||j.addClass(d._buttonClasses.insert)}if(!d.hideButtons.remove){var j=P(d.customGridButtons.remove,"ui-icon-trash").attr({id:d.idPrefix+"_Delete_"+i,title:d._i18n.remove,tabindex:-1}).addClass("remove").data("appendGrid",{uniqueIndex:i}).click(function(e){var o=t(this).data("appendGrid").uniqueIndex;return f(n,null,o,!1),e&&e.preventDefault&&e.preventDefault(),!1}).appendTo(u);C(d._buttonClasses.remove)||j.addClass(d._buttonClasses.remove)}if(!d.hideButtons.moveUp){var j=P(d.customGridButtons.moveUp,"ui-icon-arrowthick-1-n").attr({id:d.idPrefix+"_MoveUp_"+i,title:d._i18n.moveUp,tabindex:-1}).addClass("moveUp").data("appendGrid",{uniqueIndex:i}).click(function(e){var o=t(this).data("appendGrid").uniqueIndex;return t(n).appendGrid("moveUpRow",null,o),e&&e.preventDefault&&e.preventDefault(),!1}).appendTo(u);C(d._buttonClasses.moveUp)||j.addClass(d._buttonClasses.moveUp)}if(!d.hideButtons.moveDown){var j=P(d.customGridButtons.moveDown,"ui-icon-arrowthick-1-s").attr({id:d.idPrefix+"_MoveDown_"+i,title:d._i18n.moveDown,tabindex:-1}).addClass("moveDown").data("appendGrid",{uniqueIndex:i}).click(function(e){var o=t(this).data("appendGrid").uniqueIndex;return t(n).appendGrid("moveDownRow",null,o),e&&e.preventDefault&&e.preventDefault(),!1}).appendTo(u);C(d._buttonClasses.moveDown)||j.addClass(d._buttonClasses.moveDown)}if(d.rowDragging){var j=t("<div/>").addClass("rowDrag ui-state-default ui-corner-all").attr("title",d._i18n.rowDrag).append(t("<div/>").addClass("ui-icon ui-icon-caret-2-n-s").append(t("<span/>").addClass("ui-button-text").text("Drag"))).appendTo(u);C(d._buttonClasses.rowDrag)||j.addClass(d._buttonClasses.rowDrag)}for(var S=0;S<p.length;S++)(a=document.createElement("input")).id=d.idPrefix+"_"+d.columns[p[S]].name+"_"+i,e.isFunction(d.nameFormatter)?a.name=d.nameFormatter(d.idPrefix,d.columns[S].name,i):a.name=a.id,a.type="hidden",R?a.value=o[k][d.columns[p[S]].name]:C(d.columns[p[S]].value)||(a.value=d.columns[p[S]].value),u.appendChild(a);if(d.customRowButtons&&d.customRowButtons.length){for(var S=d.customRowButtons.length-1;S>=0;S--){var U=d.customRowButtons[S];U&&U.uiButton&&U.click&&U.atTheFront&&t(u).prepend(h(n,U,i))}for(var S=0;S<d.customRowButtons.length;S++){var U=d.customRowButtons[S];U&&U.uiButton&&U.click&&!U.atTheFront&&t(u).append(h(n,U,i))}}}d.useSubPanel&&(w.appendChild(u=document.createElement("td")),u.className="ui-widget-content",u.colSpan=d._visibleCount+(d._hideLastColumn?0:1),e.isFunction(d.subPanelBuilder)&&d.subPanelBuilder(u,i))}if(0<d.maxBodyHeight&&d._calculateWidth&&!g){var W=t("#"+d._wrapperId+">div.scroller")[0];W.scrollHeight>W.offsetHeight&&(g=!0,d._calculateWidth=!1)}if(y(n,d),g&&d.autoColumnWidth&&d.maxBodyHeight>0&&N(document.getElementById(d._wrapperId)),e.isNumeric(r)?e.isFunction(d.afterRowInserted)&&d.afterRowInserted(n,m,c):e.isFunction(d.afterRowAppended)&&d.afterRowAppended(n,m,c),_&&e.isFunction(d.maxNumRowsReached)&&d.maxNumRowsReached(),d.maintainScroll&&!e.isNumeric(r)){var H=t(n).height();t(n).scrollParent().scrollTop(x+H-b)}return{addedRows:c,parentIndex:m,rowIndex:r}}function p(e,n){var o=t("<button/>").attr({type:"button",tabindex:-1}).button(n.uiButton).click({tbWhole:e},n.click);return n.btnClass&&o.addClass(n.btnClass),n.btnCss&&o.css(n.btnCss),n.btnAttr&&o.attr(n.btnAttr),o}function h(e,n,o){var r=t("<button/>").val(o).attr({type:"button",tabindex:-1}).button(n.uiButton).click({tbWhole:e,uniqueIndex:o},function(e){var o=t(e.data.tbWhole).appendGrid("getRowValue",null,e.data.uniqueIndex);n.click(e,e.data.uniqueIndex,o)});return n.btnClass&&r.addClass(n.btnClass),n.btnCss&&r.css(n.btnCss),n.btnAttr&&r.attr(n.btnAttr),r}function f(n,o,r,l){var i=t(n).data("appendGrid"),a=n.getElementsByTagName("tbody")[0];if(e.isNumeric(r))for(var s=0;s<i._rowOrder.length;s++)if(i._rowOrder[s]==r){o=s;break}if(e.isNumeric(o))(l||"function"!=typeof i.beforeRowRemove||i.beforeRowRemove(n,o))&&(i._rowOrder.splice(o,1),i.useSubPanel?(a.removeChild(a.childNodes[2*o]),a.removeChild(a.childNodes[2*o])):a.removeChild(a.childNodes[o]),y(n,i),_(n,o),e.isFunction(i.afterRowRemoved)&&i.afterRowRemoved(n,o));else{var u=0,d=0;if(i.maintainScroll&&(u=t(n).height(),d=t(n).scrollParent().scrollTop()),(l||!e.isFunction(i.beforeRowRemove)||i.beforeRowRemove(n,i._rowOrder.length-1))&&(r=i._rowOrder.pop(),a.removeChild(a.lastChild),i.useSubPanel&&a.removeChild(a.lastChild),y(n,i),e.isFunction(i.afterRowRemoved)&&i.afterRowRemoved(n,null)),i.maintainScroll){var c=t(n).height();t(n).scrollParent().scrollTop(d+c-u)}}0==i._rowOrder.length&&v(document.getElementById(i._wrapperId),i)}function v(e,n,o){var r=t("<td></td>").text(n._i18n.rowEmpty).attr("colspan",n._finalColSpan);t("table.body tbody",e).append(t("<tr></tr>").addClass("empty").append(r)),!o&&n.maxBodyHeight>0&&(n.autoColumnWidth?N(e):r.width(t("table.head",e).width()-4))}function w(e){var n=t(e).data("appendGrid");t("tbody",e).empty(),n._rowOrder.length=0,n._uniqueIndex=0,y(e,n),v(document.getElementById(n._wrapperId),n)}function _(e,n){var o=t(e).data("appendGrid");if(!o.hideRowNumColumn)for(var r=n;r<o._rowOrder.length;r++)t("#"+o.idPrefix+"_Row_"+o._rowOrder[r]+" td.first",e).text(r+1)}function g(n,o,r){var l,i,a=t(n).data("appendGrid");if(a){if(l=n.getElementsByTagName("tbody")[0],t(l).empty(),a._rowOrder.length=0,a._uniqueIndex=0,null!=o&&o.length){i=m(n,o.length,null,null);for(var s=0;s<i.addedRows.length;s++){for(var u=0;u<a.columns.length;u++)B(a,u,a._rowOrder[s],o[s][a.columns[u].name]);e.isFunction(a.rowDataLoaded)&&a.rowDataLoaded(n,o[s],s,a._rowOrder[s])}}a._isDataLoaded=!0,r&&(a.initData=null),t(n).data("appendGrid",a),e.isFunction(a.dataLoaded)&&a.dataLoaded(n,o)}}function b(e,t){for(var n=0;n<t._rowOrder.length;n++)if(t._rowOrder[n]==e)return n;return null}function C(e){return void 0===e||null==e}function y(e,n){t(e).data("appendGrid",n),t("#"+n.idPrefix+"_rowOrder",e).val(n._rowOrder.join())}function x(t,n,o){for(var r={},l=null,i=C(o)?"":"_"+o,a=0;a<t.columns.length;a++)l=t.columns[a].name+i,r[l]=O(t,a,n);if(t.useSubPanel&&e.isFunction(t.subPanelGetter)){var s=t.subPanelGetter(n);if(e.isPlainObject(s))if(""==i)e.extend(r,s);else{var u={};for(var d in s)u[d+i]=s[d];e.extend(r,u)}}return r}function O(n,o,r){var l=n.columns[o].type,i=n.columns[o].name;if("custom"==l)return e.isFunction(n.columns[o].customGetter)?n.columns[o].customGetter(n.idPrefix,i,r):null;var a=R(l,n.idPrefix,i,r);return null==a?null:"checkbox"==l?a.checked?1:0:t(a).val()}function R(e,t,n,o){return document.getElementById(t+"_"+n+"_"+o)}function B(n,o,r,l){var i=n.columns[o].type,a=n.columns[o].name;if("custom"==i)e.isFunction(n.columns[o].customSetter)&&n.columns[o].customSetter(n.idPrefix,a,r,l);else{var s=R(i,n.idPrefix,a,r);"checkbox"==i?s.checked=null!=l&&0!=l:"ui-selectmenu"==i?(s.value=null==l?"":l,t(s).selectmenu("refresh")):t(s).val(null==l?"":l)}}function P(n,o){var r=null;return n&&(e.isFunction(n)?r=t(n()):n.nodeType?r=t(n).clone():(n.icon||n.label)&&(r=t("<button/>").attr({type:"button"}).button(n))),r||(r=t("<button/>").attr({type:"button"}).button({icon:o,showLabel:!1})),r}function k(t,n){for(var o=0;o<t.columns.length;o++){var r=t._rowOrder[n],l=O(t,o,r);if(e.isFunction(t.columns[o].emptyCriteria)){if(!t.columns[o].emptyCriteria(l))return!1}else{var i=null;if(C(t.columns[o].emptyCriteria))if("checkbox"==t.columns[o].type)i=0;else if("select"==t.columns[o].type||"ui-selectmenu"==t.columns[o].type){var a=R(t.columns[o].type,t.idPrefix,t.columns[o].name,r).options;i=a.length>0?a[0].value:""}else i="";else i=t.columns[o].emptyCriteria;if(l!=i)return!1}}return!0}function N(e){var n=t("table.body",e),o=t("div.scroller",e),r=n.data("appendGrid"),l=t("table.head tr.columnHead",e)[0],i=t("table.body colgroup",e)[0];if(r._rowOrder.length>0){t("td",l).width("auto"),t("col",i).width("auto"),n.width("auto"),o.width("auto");var a=t("tbody tr",n)[0],s=-2;t.fn.modal&&(s=1);for(var u=Math.min(l.childNodes.length,a.childNodes.length),d=0;d<u;d++){var c=l.childNodes[d].clientWidth+1,m=a.childNodes[d].clientWidth+s;m>c?l.childNodes[d].style.width=m+"px":i.childNodes[d].style.width=c+"px"}}else t("table.body,table.foot",e).width(t("table.head").width());t("table.foot",e).width(n.width()),o.width(n.width()+o[0].offsetWidth-o[0].clientWidth+1)}t.fn.appendGrid=function(e){return d[e]?d[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void alert(l.notSupportMethod+e):d.init.apply(this,arguments)}}),e("skylark-jqueryui-appendgrid/main",["skylark-domx-query","./appendGrid"],function(e){return e}),e("skylark-jqueryui-appendgrid",["skylark-jqueryui-appendgrid/main"],function(e){return e})}(n),!o){var i=require("skylark-langx-ns");r?module.exports=i:t.skylarkjs=i}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-jqueryui-appendgrid.js.map
